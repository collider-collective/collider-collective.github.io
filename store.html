<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script
    src="https://www.paypal.com/sdk/js?client-id=Ab18YP2iUz2VelExL_Z4a0lbNTvRxSDcOW2ulKMseZOIideUIdJteCgOmiZ-ht1UGTorcIM7K8d3rCRY&currency=AUD&locale=en_AU" data-sdk-integration-source="button-factory"> //change client ID</script> 

    



    
    <title>Collider: Store</title>
</head>
<body>


<header>
    <a href="index.html"><button id="button_store">Home</button></a>
    <a href="work.html"><button id="button_work">Work</button></a>
    <a href="about.html"><button id="button_about">About</button></a>
</header>


    <button id="button_cart" value = 0>Cart (0)</button>



<div id="store-wrapper">
    <!-- normal store container class + a top id solely for top-border-->
    <div id = "store-container-top" class = "store-container">
        
        <!-- made a block div for the store info to sit in-->
        <div class ="store-info" value = "150" name = "1038 (2021)" >
            <div class="store-top">
                <p>Zachariah Micallef</p>
                <p>(150.00 AUD)</p>
            </div>

            <div class="store-center">
                <p>1038 (2021)</p>
                <p><button>Info</button></p>
            </div>

        <div  class="store-bottom">
            <p>80 pg, 160GSM Matte, Coptic Bound</p>
            <p><button onclick="addToCart(this)">Add to Cart</button></p>
        </div>
    </div>
        <!-- made a img-container as a block for the store-images flex box to sit in-->
        <div class = "store-images-cont">
            <div   class ="store-images">
                <!-- no div needed, just img tags are fine-->
                <img src="b1-min.jpg" data-original="bible1-min.jpg">
                <img src="b2-min.jpg" data-original="bible2-min.jpg">
                <img src="b3-min.jpg" data-original="bible3-min.jpg">
                <img src="b4-min.jpg" data-original="bible4-min.jpg">
                <img src="b5-min.jpg" data-original="bible5-min.jpg">
                <img src="b6-min.jpg" data-original="bible6-min.jpg">
            </div>
        </div>
    </div>
    <div class = "store-container">
        
        <!-- made a block div for the store info to sit in-->
        <div class ="store-info" value = "1" name = "PROJECT" >
            <div class="store-top">
                <p>MAUD</p>
                <p>1.00 AUD</p>
            </div>

            <div class="store-center">
                <p>Windows (2021)</p>
            </div>

        <div  class="store-bottom">
            <p>50 pg, 80gsm Japanese Handmade Paper</p>
            <p><button onclick="addToCart(this)">Add to Cart</button></p>
        </div>
    </div>
        <!-- made a img-container as a block for the store-images flex box to sit in-->
        <div class = "store-images-cont">
            <div   class ="store-images">
                <!-- no div needed, just img tags are fine-->
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
                <img src="image-placeholder.jpg" data-original="image-placeholder.jpg">
            </div>
        </div>
    </div>

</div>
    

<div id = "cart-cont" >

    <div id = "cart-header">


    </div>   
    
    <div id = "cart">
    </div>
    <div id = "pp"> <button id = "checkout" onmouseover="boxSaddowOff(this)" onmouseout="boxSaddowOn(this,'2.5px 2.5px 1.5px gray')" > CHECKOUT </button>
        <div id = "p">
        <div id="smart-button-container">
            <div style="text-align: center;">
              <div id="paypal-button-container" onmouseover="boxSaddowOffid('checkout')" onmouseout="boxSaddowOnid('checkout','2.5px 2.5px 1.5px gray')"></div>
            </div>
          </div></div></div>

   

    
    
   
</div>
</div>

<div class="modal">
	<img src="" alt="" class="full-image">
</div>

</body>

<!--Modal Script-->
<script>

    const modal = document.querySelector('.modal');
    const previews = document.querySelectorAll('img');
    const original = document.querySelector('.full-image');
    
    previews.forEach(preview => {
        preview.addEventListener('click', () => {
            modal.classList.add('open');
            original.classList.add('open');
            //Dynamic change text and image
            const originalSrc = preview.getAttribute('data-original');
            original.src = `${originalSrc}`
        })
    })
    
    modal.addEventListener('click', (e) => {
        if(e.target.classList.contains('modal')){
            modal.classList.remove('open');
            original.classList.remove('open');
        }
    
    })
</script>

<script>
        //remove this when page goes live
        localStorage.clear()
        
        function boxSaddowOff(object){
        object.style.boxShadow = "0px 0px 0px white";
        }
        function boxSaddowOn(object,settings){
        object.style.boxShadow = settings;
        }
        function boxSaddowOffid(object){
        document.getElementById(object).style.boxShadow = "0px 0px 0px white";
        }
        function boxSaddowOnid(object,settings){
            document.getElementById(object).style.boxShadow = settings;
        }

      
        //When add to cart is clicked
        //check if local storage exist for item

        
        function addToCart(object){

        const item = new Array(object.parentNode.parentNode.parentNode.getAttribute("name"),object.parentNode.parentNode.parentNode.getAttribute("value"),1); 


        //if local storage doesn't exist, initaillise value of 0
        if (localStorage.getItem(object.parentNode.parentNode.parentNode.getAttribute("name")) == null) {
            localStorage.setItem("item-"+object.parentNode.parentNode.parentNode.getAttribute("name"), item); 
            

        }
        
    
        updateCart()
        }




        //Toggles cart visablily when cart-botton is clicked
        //
        cartButton = document.getElementById("button_cart");
        cartButton.addEventListener("click", function() { 
        cart =  document.getElementById('cart-cont')
            
            

            if (cart.style.right == "0px"){
                cart.style.right = "-90vw";
            }
            else{
                cart.style.right = "0px";
            }
        })


    function updateCart(){

            //clear cart contents
            cart = document.getElementById("cart")
            cart.innerHTML = '';

           

            for (var i = 0; i < localStorage.length; i++) {
                //checks local storage for cart items (var i = 0; i < localStorage.length; i++) {
            
                if (localStorage.key(i).substr(0, 4) == "item") {
                
                    itemKey = localStorage.key(i);
                    itemData = localStorage.getItem(itemKey);
                    itemData = itemData.split(",");
                    
                    //[3]=quant
                    
                    if (parseInt(itemData[2]) > 0 ){
                        
                        var cartItem = document.createElement("DIV");
                        cartItem.className = "cart-item";
                        cartItem.setAttribute('onmouseover','boxSaddowOff(this)');
                        cartItem.setAttribute('onmouseout','boxSaddowOn(this, "5px 5px 5px grey")');
                        cart.appendChild(cartItem);
                        
                        var itemNameCont  = document.createElement("DIV");
                        itemNameCont.className = "item-name-cont";
                        cartItem.appendChild(itemNameCont);
                        
                        
                        var itemName = document.createElement("A");
                        itemName.className = "item-name";
                        itemName.innerHTML = itemData[0];
                        itemNameCont.appendChild(itemName);
                        
                        var quantPrice = document.createElement("DIV");
                        quantPrice.className = "quant-price";
                        cartItem.appendChild(quantPrice);
                        
                        var quantCont = document.createElement("DIV");
                        quantCont.className = "quant-cont";
                        quantPrice.appendChild(quantCont);
                        
                        
                        
                        var selectMinus = document.createElement("BUTTON");
                        selectMinus.className = "quant-selector";
                        selectMinus.innerHTML = "-";
                        selectMinus.setAttribute('onclick','selector(this)')
                        selectMinus.setAttribute('onmouseover','boxSaddowOff(this)');
                        selectMinus.setAttribute('onmouseout','boxSaddowOn(this, "1.5px 1.5px 1.5px grey")');
                        
                        quantCont.appendChild(selectMinus);
                        

                        var quantity = document.createElement("A");
                        quantity.className = "quantity";
                        quantity.innerHTML = itemData[2];
                        quantCont.appendChild(quantity);

                        var selectPlus = document.createElement("BUTTON");
                        selectPlus.className = "quant-selector";
                        selectPlus.innerHTML = "+";
                        selectPlus.setAttribute('onclick','selector(this)');
                        selectPlus.setAttribute('onmouseover','boxSaddowOff(this)');
                        selectPlus.setAttribute('onmouseout','boxSaddowOn(this, "1.5px 1.5px 1.5px grey")');
                        quantCont.appendChild(selectPlus);
                        
                    
                        
                
                    
                    
                    
                    
                    
                    
                        //add event listner for selection change --> update cart


                        var itemTotal = document.createElement("A");
                        itemTotal.className = "item-total";
                    
                        //update get price
                        var price = parseInt(itemData[2])*parseInt(itemData[1]);
                        itemTotal.innerHTML = "$"+(price);
                    
                        quantPrice.appendChild(itemTotal);

                       
            
            
                }
                
            }
               
                   
              
        }
        document.getElementById("button_cart").innerHTML = "Cart ("+ document.getElementsByClassName("cart-item").length + ")"  
        if (document.getElementsByClassName("cart-item").length ==0){
            var empty = document.createElement("H3");
                empty.innerHTML = "YOUR CART IS EMPTY"
                empty.className = "empty-cart";
                cart.appendChild(empty);
                document.getElementById("pp").style.display = "none";
                
        }
        else{
            document.getElementById("pp").style.display = "block";
            var subTotal = document.createElement("DIV");
                            subTotal.className = "subtotal";
                            
                            
                            itemTotals = document.getElementsByClassName("item-total");
                            
                            subTotalPrice = 0;
                            
                            for (let i = 0; itemTotals.length > i; i++){
                                
                                x = itemTotals[i].innerHTML.substring(1);
                                
                            
                                subTotalPrice = subTotalPrice + parseInt(x);


                            }
                            subTotal.innerHTML = "SUB-TOTAL: $"+subTotalPrice;

                            cart.appendChild(subTotal);

                            var shipping = document.createElement("DIV");
                                shipping.className = "subtotal";
                                shipping.id = "get-shipping-price";
                                shipping.innerHTML = " PARCEL POSTAGE: $15";
                                cart.appendChild(shipping);

                                totalPrice = document.createElement("DIV");
                                totalPrice.className = "subtotal";
                                totalPrice.id = "get-final-price"
                                totalPrice.innerHTML = "TOTAL: $"+ String(parseInt(15) + parseInt(subTotalPrice));
                                cart.appendChild(totalPrice);
                            
                            
                            
                            
                            //clear paypal button
                            document.getElementById("paypal-button-container").innerHTML = "";
                            initPayPalButton();

                          
                            




                            
        }
                          
    }  


    function selector(object){

        cartItem = object.parentElement.parentElement.parentElement;

        

        cartItemName = cartItem.querySelector(".item-name").innerHTML;

        localData = localStorage.getItem("item-"+cartItemName).split(",");

        if(object.innerHTML == "+"){
            localData[2] = parseInt(localData[2]) + 1; 
        }
        else{
            localData[2] = parseInt(localData[2]) - 1;
        }

        localStorage.setItem("item-"+cartItemName, localData);
        
        
        
        
        updateCart()
        
    }


    
updateCart()
    


</script>

<script>
    function initPayPalButton() {
      
		var paypalItemsArray = [];
		
		paypal.Buttons({
        style: {
        shape: 'pill',
          color: 'white',
          layout: 'vertical',
          label: 'pay',
          
        },
		  
		 
		  
		  
		  
		  //get total
		  
		  
		  //get shipping method
		  
		  

        createOrder: function(data, actions) {
          
			//get items array
		  
		  
		  items = document.getElementsByClassName("cart-item");
          
		  
		
			
		  for (var i = 0; i < items.length; i++){
		  
		    paypalItemName = items[i].querySelector(".item-name").innerHTML;
            
		    paypalItemQuant = items[i].querySelector(".quantity").innerHTML;
            
			paypalItemTotalPrice = items[i].querySelector(".item-total").innerHTML;
            
            paypalItemTotalPrice = paypalItemTotalPrice.substring(1)
		    paypalPrice = paypalItemTotalPrice / paypalItemQuant;
	  
			 paypalItemsArray.push({"name": paypalItemName,
			"unit_amount": {
            "currency_code": "AUD",
            "value": paypalPrice},
			"quantity": paypalItemQuant })
		  
		  
		  }
			
          
			
			finalPrice = document.getElementById("get-final-price").innerHTML
            finalPrice = parseFloat(String(finalPrice).substring(8))
            shippingPrice = document.getElementById("get-shipping-price").innerHTML;
			console.log(String(shippingPrice.substring(18)))
            shippingPrice = parseFloat(String(shippingPrice.substring(18)))
            
            itemTotal = (finalPrice - shippingPrice);
		
			
			return actions.order.create({
            purchase_units: [{"description":"COLLIDER WEB STORE PURCHASE",
							  "amount": {
        "currency_code": "AUD",
        "value": finalPrice,
        "breakdown": {
          "item_total": {
            "currency_code": "AUD",
            "value": itemTotal
          },
          "shipping": {
            "currency_code": "AUD",
            "value": shippingPrice
          }}}
							  
							  
							 ,"items": paypalItemsArray } ]
			
		  
		  });
        },
			
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            alert('Transaction completed by ' + details.payer.name.given_name + ": we're most greatful for the support");
            // --> page after puchase
            localStorage.clear()
            updateCart()
          });
        },

        onError: function(err) {
          console.log(err);
        },
			onCancel: function(data, actions) {
    },
		
      }).render('#paypal-button-container');
    }
    
  </script>



</html>